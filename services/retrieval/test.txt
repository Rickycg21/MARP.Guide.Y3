0) (Optional) Clean Chroma index for a fresh test
docker compose exec -T retrieval python - <<'PY'
import os, chromadb
pc = chromadb.PersistentClient(path=os.getenv("CHROMA_DIR","/data/index") or "/data/index")
try:
    pc.delete_collection(os.getenv("CHROMA_COLLECTION") or "marp_chunks")
    print("Deleted collection: marp_chunks")
except Exception as e:
    print("Nothing to delete or already clean:", e)
PY

1) Docker Commands
docker compose build retrieval --no-cache
docker compose up -d retrieval

(Optional)
docker compose logs -f retrieval

2) Seed two test chunks into Chroma (simulates “indexing done”)
docker compose exec -T retrieval python - <<'PY'
import os, chromadb
pc = chromadb.PersistentClient(path=os.getenv("CHROMA_DIR","/data/index") or "/data/index")
coll = (os.getenv("CHROMA_COLLECTION") or "marp_chunks")
c = pc.get_or_create_collection(coll, metadata={"hnsw:space":"cosine"})
try:
    c.add(
        ids=["slides_week03#p12#c3","slides_week03#p5#c1"],
        embeddings=[[0.1,0.2,0.7],[0.9,0.1,0.0]],
        documents=[
            "All events share an envelope: eventType, eventId, timestamp, correlationId, source, version.",
            "Event-driven architecture uses producers, exchanges, and consumers.",
        ],
        metadatas=[
            {"document_id":"slides_week03","chunk_id":"slides_week03#p12#c3","page":12,"title":"Week 3 — Events","url":"/docs/week_03.pdf#page=12"},
            {"document_id":"slides_week03","chunk_id":"slides_week03#p5#c1","page":5,"title":"Week 3 — EDA","url":"/docs/week_03.pdf#page=5"},
        ],
    )
    print("Seeded:", coll)
except Exception as e:
    print("Maybe already seeded:", e, " count=", c.count())
PY

3) Health check
curl -s http://localhost:5004/health | jq

4) Run a search
curl -s "http://localhost:5004/search?q=event%20envelope%20fields&topK=5&mode=semantic" | jq

